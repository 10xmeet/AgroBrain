{% extends 'myapp/base.html' %}

{% block title %}AgriTech News{% endblock %}

{% block extra_head %}
<style>
    /* Theme Variables */
    :root {
        --primary-color: #16a34a;
        --primary-dark: #15803d;
        --primary-light: #dcfce7;
        --accent-color: #f59e0b;
        --text-color: #1f2937;
        --text-light: #6b7280;
        --bg-color: #f9fafb;
        --card-bg: #ffffff;
        --card-border: #e5e7eb;
        --card-shadow: rgba(0, 0, 0, 0.05);
        --animation-speed: 0.3s;
    }

    /* Dark Theme Variables */
    .dark-theme {
        --primary-color: #10b981;
        --primary-dark: #059669;
        --primary-light: #064e3b;
        --accent-color: #f59e0b;
        --text-color: #f3f4f6;
        --text-light: #9ca3af;
        --bg-color: #1f2937;
        --card-bg: #111827;
        --card-border: #374151;
        --card-shadow: rgba(0, 0, 0, 0.3);
    }
    
    /* Ensure header and footer are visible */
    header, footer {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        z-index: 50 !important;
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes growUp {
        0% { height: 0; opacity: 0; }
        100% { height: 24px; opacity: 1; }
    }

    /* Plant Growth Animation */
    .plant-growth {
        position: relative;
        width: 24px;
        height: 24px;
        margin-right: 8px;
    }

    .plant-stem {
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 2px;
        background-color: var(--primary-color);
        transform: translateX(-50%);
        animation: growUp 1.5s ease-out;
    }

    .plant-leaf {
        position: absolute;
        width: 8px;
        height: 8px;
        background-color: var(--primary-light);
        border-radius: 50% 0;
        opacity: 0;
        transform-origin: bottom center;
    }

    .plant-leaf:nth-child(2) {
        top: 8px;
        left: 6px;
        transform: rotate(-45deg);
        animation: fadeIn 0.3s ease-out 0.8s forwards;
    }

    .plant-leaf:nth-child(3) {
        top: 8px;
        right: 6px;
        transform: rotate(45deg);
        animation: fadeIn 0.3s ease-out 1s forwards;
    }

    .plant-leaf:nth-child(4) {
        top: 2px;
        left: 8px;
        transform: rotate(-15deg);
        animation: fadeIn 0.3s ease-out 1.2s forwards;
    }

    /* Page Transitions */
    .page-transition {
        animation: fadeIn var(--animation-speed) ease-out;
    }

    /* Card Hover Effects */
    .news-card {
        transition: all var(--animation-speed) ease;
        border-color: var(--card-border);
        background-color: var(--card-bg);
        box-shadow: 0 4px 6px var(--card-shadow);
    }

    .news-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 20px var(--card-shadow);
        border-color: var(--primary-color);
    }

    .news-card img {
        transition: all var(--animation-speed) ease;
    }

    .news-card:hover img {
        transform: scale(1.05);
    }

    /* Category Pills */
    .category-pill {
        transition: all var(--animation-speed) ease;
        background-color: var(--primary-light);
        color: var(--primary-dark);
    }

    .category-pill:hover, .category-pill.active {
        background-color: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    /* Loading Animation */
    .loading-spinner {
        display: none;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Pagination Buttons */
    .pagination-btn {
        transition: all var(--animation-speed) ease;
    }

    .pagination-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--card-shadow);
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Theme Toggle */
    .theme-toggle {
        position: relative;
        width: 60px;
        height: 30px;
        border-radius: 15px;
        background-color: var(--bg-color);
        border: 2px solid var(--primary-color);
        cursor: pointer;
        transition: all var(--animation-speed) ease;
    }

    .toggle-circle {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background-color: var(--primary-color);
        transition: all var(--animation-speed) ease;
    }

    .dark-theme .toggle-circle {
        left: 32px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .filters-container {
            flex-direction: column;
            align-items: stretch;
        }
        
        .category-pills {
            overflow-x: auto;
            padding-bottom: 8px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Loading Animation (initially hidden, shown via JS) -->
<div id="page-loader" class="fixed inset-0 bg-white bg-opacity-80 z-40 flex items-center justify-center" style="display: none;">
    <div class="flex flex-col items-center">
        <div class="plant-growth scale-150 mb-4">
            <div class="plant-stem"></div>
            <div class="plant-leaf"></div>
            <div class="plant-leaf"></div>
            <div class="plant-leaf"></div>
        </div>
        <p class="text-primary-600 font-medium">Loading fresh content...</p>
    </div>
</div>

<!-- Header Section with Plant Animation -->
<section class="bg-gradient-to-r from-emerald-100 to-emerald-50 py-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <div class="flex items-center justify-center mb-4">
            <div class="plant-growth">
                <div class="plant-stem"></div>
                <div class="plant-leaf"></div>
                <div class="plant-leaf"></div>
                <div class="plant-leaf"></div>
            </div>
            <h1 class="text-3xl font-bold text-emerald-800">
                Agricultural News Hub
            </h1>
        </div>
        <p class="text-emerald-600 max-w-2xl mx-auto text-lg">
            Stay informed with the latest innovations, market trends, and sustainable practices in modern farming
        </p>
        
        <!-- Theme Toggle -->
        <div class="flex justify-center mt-6">
            <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-600">Light</span>
                <div id="theme-toggle" class="theme-toggle">
                    <div class="toggle-circle"></div>
                </div>
                <span class="text-sm text-gray-600">Dark</span>
            </div>
        </div>
    </div>
</section>

<!-- Filters Section -->
<div class="bg-emerald-50 py-6 border-y border-emerald-100">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="filters-container flex flex-wrap justify-between items-center gap-4">
            <!-- Categories -->
            <div class="w-full md:w-auto">
                <h3 class="text-sm font-medium text-emerald-800 mb-2">Filter by Category:</h3>
                <div class="category-pills flex flex-wrap gap-2">
                    {% for cat in categories %}
                    <a href="?category={{ cat }}&sort_by={{ sort_by }}" 
                       class="category-pill px-4 py-1.5 rounded-full text-sm font-medium {% if category == cat %}active{% endif %}">
                        {{ cat|title }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Sort Options -->
            <div class="w-full md:w-auto">
                <h3 class="text-sm font-medium text-emerald-800 mb-2">Sort by:</h3>
                <div class="flex gap-2">
                    {% for sort_value, sort_label in sort_options %}
                    <a href="?category={{ category }}&sort_by={{ sort_value }}" 
                       class="category-pill px-4 py-1.5 rounded-full text-sm font-medium {% if sort_by == sort_value %}active{% endif %}">
                        {{ sort_label }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<main class="bg-emerald-50 py-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
        {% if error %}
        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
            {{ error }}
        </div>
        {% endif %}
        
        <!-- News Grid -->
         <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
             {% for title, desc, img_url in mylist %}
             <article class="news-card rounded-xl p-4 overflow-hidden">
                 <div class="relative overflow-hidden rounded-lg mb-4">
                     <img class="w-full h-48 object-cover" 
                          src="{{ img_url|default:'https://media-hosting.imagekit.io//ff484b6067a44be7/WhatsApp%20Image%202025-02-06%20at%2022.48.37_25324311.jpg?Expires=1833470625&Key-Pair-Id=K2ZIVPTIP2VGHC&Signature=2QKZC1A7mKCM8EGP67Ny2kA6gykV-DGJqdlSG0bS84WzYFttFNd6hYaqJF8PpYKxME7PXx6GjyrmSi9NPKWg-0zj0ucziQORVwoKml1qxtd9YhKrd6rzFixzIa4FxwSAL2WkrTD-V6OEV7ah~UCpzudWdJjWJHBdo7io3rdzoiEvpxOoy6HOKPR3EsZ9mXP5D9ZYv6BEvSnbz6MXPa2yGtuNeK0ruMeX1p-isuRenLKgFQIjnpmcU0c51yMZVk3GreJ7sSmC-mllwpgKRzrL6H9m7FPWP~ugf13V8ahu2T7qBk9ft03UG8E7EJGg8num-nLrVN4eaTN1xEiXv4uiWw__ ' }}" 
                          alt="{{ title }}">
                     <div class="absolute top-2 right-2 bg-emerald-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                         Agricultural News
                     </div>
                 </div>
                 <div class="p-2">
                     <h3 class="text-lg font-semibold mb-2 hover:text-emerald-600 transition-colors">{{ title }}</h3>
                     <p class="text-sm mb-4 line-clamp-3">{{ desc }}</p>
                     <div class="flex items-center justify-between text-xs">
                         <div class="flex items-center">
                             <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                             </svg>
                             <span>Recent Update</span>
                         </div>
                         <div class="flex items-center font-medium hover:text-emerald-600 transition-colors">
                             Read More
                             <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                             </svg>
                         </div>
                     </div>
                 </div>
             </article>
            {% empty %}
            <div class="col-span-3 text-center py-12">
                <svg class="w-16 h-16 mx-auto text-emerald-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <h3 class="text-xl font-medium text-emerald-800 mb-2">No articles found</h3>
                <p class="text-emerald-600">Try changing your search filters or check back later for new content.</p>
            </div>
            {% endfor %}
        </div>
        
        <!-- Loading Spinner -->
        <div class="flex justify-center mt-8">
            <div id="loading-spinner" class="loading-spinner"></div>
        </div>
        
        <!-- Pagination -->
        {% if mylist %}
        <div class="flex justify-center items-center space-x-4 mt-12">
            <a href="?category={{ category }}&sort_by={{ sort_by }}&page={{ prev_page }}" 
               class="pagination-btn px-4 py-2 bg-white border border-emerald-200 rounded-lg flex items-center {% if not has_prev %}opacity-50 cursor-not-allowed{% endif %}"
               {% if not has_prev %}disabled{% endif %}>
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Previous
            </a>
            
            <span class="text-sm font-medium">Page {{ current_page }} of {{ total_pages }}</span>
            
            <a href="?category={{ category }}&sort_by={{ sort_by }}&page={{ next_page }}" 
               class="pagination-btn px-4 py-2 bg-white border border-emerald-200 rounded-lg flex items-center {% if not has_next %}opacity-50 cursor-not-allowed{% endif %}"
               {% if not has_next %}disabled{% endif %}>
                Next
                <svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </a>
        </div>
        {% endif %}
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Theme Toggle Functionality
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('agrobrain-theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-theme');
        }
        
        themeToggle.addEventListener('click', function() {
            body.classList.toggle('dark-theme');
            
            // Save theme preference
            if (body.classList.contains('dark-theme')) {
                localStorage.setItem('agrobrain-theme', 'dark');
            } else {
                localStorage.setItem('agrobrain-theme', 'light');
            }
        });
        
        // Page Transition Effects
        const links = document.querySelectorAll('a:not([target="_blank"])');
        const pageLoader = document.getElementById('page-loader');
        
        links.forEach(link => {
            // Only add transition to internal links that change the page
            if (link.getAttribute('href') && link.getAttribute('href').includes('?')) {
                link.addEventListener('click', function(e) {
                    // Don't show loader for disabled pagination links
                    if (this.classList.contains('cursor-not-allowed')) {
                        return;
                    }
                    
                    // Get the target URL
                    const targetUrl = this.getAttribute('href');
                    
                    // Show loading animation without preventing default behavior
                    pageLoader.style.display = 'flex';
                    
                    // Navigate after a short delay to show the animation
                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, 300);
                    
                    // Prevent default to allow our custom navigation
                    e.preventDefault();
                });
            }
        });
        
        // Animate cards on page load
        const newsCards = document.querySelectorAll('.news-card');
        newsCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100 + (index * 100)); // Stagger the animations
        });
    });
</script>
{% endblock %}